{"ast":null,"code":"\"use client\";import{useState}from\"react\";import{Upload,X}from\"lucide-react\";import apiClient from\"../services/api\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ImageUpload=_ref=>{let{onImageUploaded,currentImage,className=\"\"}=_ref;const[uploading,setUploading]=useState(false);const[preview,setPreview]=useState(currentImage||null);const handleFileSelect=async e=>{const file=e.target.files[0];if(!file)return;// Validate file type\nif(!file.type.startsWith(\"image/\")){alert(\"กรุณาเลือกไฟล์รูปภาพเท่านั้น\");return;}// Validate file size (max 5MB)\nif(file.size>5*1024*1024){alert(\"ขนาดไฟล์ต้องไม่เกิน 5MB\");return;}setUploading(true);try{// Create preview and convert to base64\nconst reader=new FileReader();reader.onload=async e=>{const base64Data=e.target.result;setPreview(base64Data);// Upload to server\nconst formData=new FormData();formData.append('file',file);const response=await apiClient.post('/upload',formData,{headers:{'Content-Type':'multipart/form-data'}});// Use base64 data for display, but store server URL for database\nconst serverUrl=`${process.env.REACT_APP_API_URL}/api/upload/image/${response.data.file.filename}`;onImageUploaded(serverUrl);};reader.readAsDataURL(file);}catch(error){var _error$response,_error$response$data;console.error(\"Upload failed:\",error);alert(`เกิดข้อผิดพลาดในการอัพโหลด: ${((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||error.message}`);setPreview(null);}finally{setUploading(false);}};const handleRemove=()=>{setPreview(null);onImageUploaded(null);};return/*#__PURE__*/_jsx(\"div\",{className:`relative ${className}`,children:preview?/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:preview||\"/placeholder.svg\",alt:\"Preview\",className:\"w-full h-48 object-cover rounded-lg border-2 border-gray-200\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRemove,className:\"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\",children:/*#__PURE__*/_jsx(X,{className:\"h-4 w-4\"})})]}):/*#__PURE__*/_jsxs(\"label\",{className:\"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center justify-center pt-5 pb-6\",children:uploading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Upload,{className:\"w-8 h-8 mb-4 text-gray-500\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mb-2 text-sm text-gray-500\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"\\u0E04\\u0E25\\u0E34\\u0E01\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E37\\u0E2D\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E23\\u0E39\\u0E1B\"}),\" \\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E25\\u0E32\\u0E01\\u0E44\\u0E1F\\u0E25\\u0E4C\\u0E21\\u0E32\\u0E27\\u0E32\\u0E07\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"PNG, JPG \\u0E2B\\u0E23\\u0E37\\u0E2D GIF (\\u0E2A\\u0E39\\u0E07\\u0E2A\\u0E38\\u0E14 5MB)\"})]})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"hidden\",accept:\"image/*\",onChange:handleFileSelect,disabled:uploading})]})});};export default ImageUpload;","map":{"version":3,"names":["useState","Upload","X","apiClient","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ImageUpload","_ref","onImageUploaded","currentImage","className","uploading","setUploading","preview","setPreview","handleFileSelect","e","file","target","files","type","startsWith","alert","size","reader","FileReader","onload","base64Data","result","formData","FormData","append","response","post","headers","serverUrl","process","env","REACT_APP_API_URL","data","filename","readAsDataURL","error","_error$response","_error$response$data","console","message","handleRemove","children","src","alt","onClick","accept","onChange","disabled"],"sources":["D:/senior.project/pet-health-docs/src/components/ImageUpload.js"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { Upload, X } from \"lucide-react\"\nimport apiClient from \"../services/api\"\n\nconst ImageUpload = ({ onImageUploaded, currentImage, className = \"\" }) => {\n  const [uploading, setUploading] = useState(false)\n  const [preview, setPreview] = useState(currentImage || null)\n\n  const handleFileSelect = async (e) => {\n    const file = e.target.files[0]\n    if (!file) return\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      alert(\"กรุณาเลือกไฟล์รูปภาพเท่านั้น\")\n      return\n    }\n\n    // Validate file size (max 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      alert(\"ขนาดไฟล์ต้องไม่เกิน 5MB\")\n      return\n    }\n\n    setUploading(true)\n\n    try {\n      // Create preview and convert to base64\n      const reader = new FileReader()\n      reader.onload = async (e) => {\n        const base64Data = e.target.result\n        setPreview(base64Data)\n        \n        // Upload to server\n        const formData = new FormData()\n        formData.append('file', file)\n\n        const response = await apiClient.post('/upload', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        })\n\n        // Use base64 data for display, but store server URL for database\n        const serverUrl = `${process.env.REACT_APP_API_URL}/api/upload/image/${response.data.file.filename}`\n        onImageUploaded(serverUrl)\n      }\n      reader.readAsDataURL(file)\n    } catch (error) {\n      console.error(\"Upload failed:\", error)\n      alert(`เกิดข้อผิดพลาดในการอัพโหลด: ${error.response?.data?.error || error.message}`)\n      setPreview(null)\n    } finally {\n      setUploading(false)\n    }\n  }\n\n  const handleRemove = () => {\n    setPreview(null)\n    onImageUploaded(null)\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      {preview ? (\n        <div className=\"relative\">\n          <img\n            src={preview || \"/placeholder.svg\"}\n            alt=\"Preview\"\n            className=\"w-full h-48 object-cover rounded-lg border-2 border-gray-200\"\n          />\n          <button\n            onClick={handleRemove}\n            className=\"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n        </div>\n      ) : (\n        <label className=\"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100\">\n          <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\n            {uploading ? (\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500\"></div>\n            ) : (\n              <>\n                <Upload className=\"w-8 h-8 mb-4 text-gray-500\" />\n                <p className=\"mb-2 text-sm text-gray-500\">\n                  <span className=\"font-semibold\">คลิกเพื่ือเลือกรูป</span> หรือลากไฟล์มาวาง\n                </p>\n                <p className=\"text-xs text-gray-500\">PNG, JPG หรือ GIF (สูงสุด 5MB)</p>\n              </>\n            )}\n          </div>\n          <input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleFileSelect} disabled={uploading} />\n        </label>\n      )}\n    </div>\n  )\n}\n\nexport default ImageUpload\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}